{
  "dburl": "sqlite:///${caleydo_server.dataDir}/bioinfodb_sample.sqlite",
  "schema_tissue": "targid",
  "schema_public": "targid",
  "index_gene": "(t.rowid-1) as _index",
  "index_tissue": "(t.rowid-1) as _index",
  "views": {
    "tissue": {
      "table": "${targid_bioinfodb.schema_tissue}_tissue",
      "idType": "Tissue",
      "columns": {
        "tissuename": { "label": "id", "type": "string" },
        "species": { "label": "species", "type": "categorical" },
        "tumortype": { "label": "tumortype", "type": "categorical" },
        "organ": { "label": "organ", "type": "categorical" },
        "gender": { "label": "gender", "type": "categorical" }
      },
      "column_query": "tissuename as id, species, tumortype, organ, gender",

      "queryCategories": "SELECT distinct %(col)s as cat FROM ${targid_bioinfodb.schema_tissue}_tissue WHERE %(col)s is not null AND %(col)s <> ''",

      "query": "SELECT ${targid_bioinfodb.index_tissue}, ${column_query} FROM ${targid_bioinfodb.schema_tissue}_tissue t"
    },
    "gene": {
      "table": "targid_gene",
      "idType": "Ensembl",
      "columns": {
        "ensg": { "label": "id", "type": "string" },
        "symbol": { "label": "symbol", "type": "string" },
        "species":{ "label": "species", "type": "categorical" },
        "chromosome":{ "label": "chromosome", "type": "string" },
        "strand": { "label": "strand", "type": "number" },
        "biotype": { "label": "biotype", "type": "categorical" }
      },
      "column_query": "ensg as id, symbol, species, chromosome, strand, biotype",

      "queryStats": "SELECT min(strand) as strand_min, max(strand) as strand_max FROM ${table}",
      "queryCategories": "SELECT DISTINCT %(col)s as cat FROM ${table} where %(col)s is not null and %(col)s <> ''",

      "query": "SELECT ${targid_bioinfodb.index_gene}, ${column_query} FROM ${table} t ORDER BY t.symbol ASC"
    },
    "gene_filtered": {
      "idType": "Ensembl",
      "query": "SELECT ${targid_bioinfodb.index_gene}, ${targid_bioinfodb.views.gene.column_query} FROM targid_gene t WHERE species = :species ORDER BY symbol ASC",
      "arguments": ["species"]
    },
    "gene_simple": {
      "idType": "Ensembl",
      "query": "SELECT ensg as id, symbol FROM targid_gene ORDER BY symbol ASC"
    },
    "gene_map_ensgs": {
      "idType": "Ensembl",
      "query": "SELECT ensg as id, symbol FROM targid_gene WHERE ensg in (%(ensgs)s) ORDER BY symbol ASC",
      "replacements": ["ensgs"]
    },
    "tissue_filtered": {
      "idType": "Tissue",
      "query": [
        "SELECT ${targid_bioinfodb.index_tissue}, ${targid_bioinfodb.views.tissue.column_query} ",
        "FROM ${targid_bioinfodb.schema_tissue}_tissue t ",
        "WHERE species = :species"
      ],
      "arguments": ["species"]
    },
    "enrichment": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, a.symbol, max(cnv) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_copynumber ab INNER JOIN ${targid_bioinfodb.schema_public}targid_gene a ON a.ensg = ab.ensg INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename= ab.tissuename ",
        "WHERE ab.cn = :cn AND b.tumortype = :tumortype AND cnv > ",
        "(SELECT max(cnv) FROM ${targid_bioinfodb.schema_tissue}_copynumber ab INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename = ab.tissuename WHERE ab.cn = :cn AND b.tumortype = :tumortype AND ab.ensg = :ensg) ",
        "GROUP BY a.ensg, a.symbol"
      ],
      "arguments": ["ensg", "cn", "tumortype"]
    },
    "enrichment_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, a.symbol, max(cnv) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_copynumber ab INNER JOIN ${targid_bioinfodb.schema_public}targid_gene a ON a.ensg = ab.ensg INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename= ab.tissuename ",
        "WHERE ab.cn = :cn AND cnv > ",
        "(SELECT max(cnv) FROM ${targid_bioinfodb.schema_tissue}_copynumber ab INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename = ab.tissuename WHERE ab.cn = :cn AND ab.ensg = :ensg) ",
        "GROUP BY a.ensg, a.symbol"
      ],
      "arguments": ["ensg", "cn"]
    },
    "onco_print": {
      "idType": "Tissue",
      "query": [
        "SELECT d.ensg as id, d.tissuename as name, cn, d.log2fpkm as expr, d.dna_mutated, g.symbol ",
        "FROM ${targid_bioinfodb.schema_tissue}_data d INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue c ON d.tissuename = c.tissuename INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON d.ensg = g.ensg ",
        "WHERE c.tumortype = :tumortype AND d.ensg in (%(ensgs)s)"
      ],
      "replacements": ["ensgs"],
      "arguments": ["tumortype"]
    },
    "onco_print_all": {
      "idType": "Tissue",
      "query": [
        "SELECT d.ensg as id, d.tissuename as name, cn, d.log2fpkm as expr, d.dna_mutated, g.symbol ",
        "FROM ${targid_bioinfodb.schema_tissue}_data d INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue c ON d.tissuename = c.tissuename INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON d.ensg = g.ensg ",
        "WHERE d.ensg in (%(ensgs)s)"
      ],
      "replacements": ["ensgs"]
    },
    "expression_score": {
      "idType": "Ensembl",
      "query": [
        "SELECT ensg as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename = ab.tissuename ",
        "WHERE b.tumortype = :tumortype ",
        "GROUP BY ab.ensg"
      ],
      "replacements": ["agg", "data_subtype"],
      "arguments": ["tumortype"]
    },
    "expression_score_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT ensg as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab ",
        "GROUP BY ab.ensg"
      ],
      "replacements": ["agg", "data_subtype"]
    },
    "copynumber_score": {
      "idType": "Ensembl",
      "query": [
        "SELECT ensg as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_copynumber ab INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename = ab.tissuename ",
        "WHERE b.tumortype = :tumortype ",
        "GROUP BY ab.ensg"
      ],
      "replacements": ["agg", "data_subtype"],
      "arguments": ["tumortype"]
    },
    "copynumber_score_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT ensg as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_copynumber ab ",
        "GROUP BY ab.ensg"
      ],
      "replacements": ["agg", "data_subtype"]
    },
    "expression_table": {
      "idType": "Tissue",
      "query": [
        "SELECT b.tissuename as id, b.species, b.organ, gender, ensg, %(data_subtype)s as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename = ab.tissuename ",
        "WHERE b.tumortype = :tumortype AND ab.ensg in (%(ensgs)s)"
      ],
      "replacements": ["data_subtype","ensgs"],
      "arguments": ["tumortype"]
    },
    "expression_table_all": {
      "idType": "Tissue",
      "query": [
        "SELECT b.tissuename as id, b.species, b.organ, gender, ensg, %(data_subtype)s as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue b ON b.tissuename = ab.tissuename ",
        "WHERE ab.ensg in (%(ensgs)s)"
      ],
      "replacements": ["data_subtype","ensgs"]
    },
    "expression_score_inverted": {
      "idType": "Tissue",
      "query": [
        "SELECT tissuename as id, %(agg)s(%(score)s) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab INNER JOIN ${targid_bioinfodb.schema_public}_gene b ON b.ensg = ab.ensg ",
        "WHERE b.biotype = :biotype ",
        "GROUP BY ab.tissuename"
      ],
      "replacements": ["agg", "score"],
      "arguments": ["biotype"]
    },
    "expression_score_inverted_all": {
      "idType": "Tissue",
      "query": [
        "SELECT tissuename as id, %(agg)s(%(score)s) as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab ",
        "GROUP BY ab.tissuename"
      ],
      "replacements": ["agg", "score"]
    },
    "expression_table_inverted": {
      "idType": "Ensembl",
      "query": [
        "SELECT b.ensg as id, b.symbol, b.species, b.strand, biotype, tissuename as name, %(score)s as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab INNER JOIN ${targid_bioinfodb.schema_public}_gene b ON b.ensg = ab.ensg ",
        "WHERE b.biotype = :biotype AND ab.tissuename in (%(names)s)"
      ],
      "replacements": ["score", "names"],
      "arguments": ["biotype"]
    },
    "expression_table_inverted_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT b.ensg as id, b.symbol, b.species, b.strand, biotype, tissuename as name, %(score)s as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_expression ab INNER JOIN ${targid_bioinfodb.schema_public}_gene b ON b.ensg = ab.ensg ",
        "WHERE ab.tissuename in (%(names)s)"
      ],
      "replacements": ["score","names"]
    },
    "tissue_gene_copynumber": {
      "idType": "Tissue",
      "query": [
        "SELECT tissuename as id, cnv as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_copynumber ",
        "WHERE ensg = :ensg"
      ],
      "arguments": ["ensg"]
    },
    "tissue_gene_mutation": {
      "idType": "Tissue",
      "query": [
        "SELECT tissuename as id, dnamutation as score ",
        "FROM ${targid_bioinfodb.schema_tissue}_mutation ",
        "WHERE ensg = :ensg"
      ],
      "arguments": ["ensg"]
    },
    "alteration_mutation_frequency": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (ifnull(mut.mutated,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM ${targid_bioinfodb.schema_tissue}_mutation m INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue c ON c.tissuename = m.tissuename WHERE c.tumortype = :tumortype group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as mutated, ensg FROM ${targid_bioinfodb.schema_tissue}_mutation m INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue c ON c.tissuename = m.tissuename WHERE c.tumortype = :tumortype AND dna_mutated = 't' group by ensg) mut ",
        "ON mut.ensg = a.ensg"
      ],
      "arguments": ["tumortype"]
    },
    "alteration_mutation_frequency_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (ifnull(mut.mutated,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM ${targid_bioinfodb.schema_tissue}_mutation group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as mutated, ensg FROM ${targid_bioinfodb.schema_tissue}_mutation where dna_mutated = 't' group by ensg) mut ON mut.ensg = a.ensg"
      ]
    },
    "alteration_cnv_frequency": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (ifnull(mut.mutated,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM ${targid_bioinfodb.schema_tissue}_copynumber m INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue c ON c.tissuename = m.tissuename WHERE c.tumortype = :tumortype group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as mutated, ensg FROM ${targid_bioinfodb.schema_tissue}_copynumber m INNER JOIN ${targid_bioinfodb.schema_tissue}_tissue c ON c.tissuename = m.tissuename WHERE c.tumortype = :tumortype AND cnv %(operator)s %(value)s group by ensg) mut ",
        "ON mut.ensg = a.ensg"
      ],
      "replacements": ["operator", "value"],
      "arguments": ["tumortype"]
    },
    "alteration_cnv_frequency_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (ifnull(mut.mutated,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM ${targid_bioinfodb.schema_tissue}_copynumber group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as mutated, ensg FROM ${targid_bioinfodb.schema_tissue}_copynumber WHERE cnv %(operator)s %(value)s group by ensg) mut ON mut.ensg = a.ensg"
      ],
      "replacements": ["operator", "value"]
    }
  }
}
