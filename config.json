{
  "dburl": "postgres://postgres:admin@10.0.2.2:5432/postgres",
  "schema_tissue": "tissue.targid",
  "schema_public": "public.targid",
  "schema_cellline": "cellline.targid",
  "index_gene": "row_number() OVER(ORDER BY ensg ASC) as _index",
  "index_cellline": "row_number() OVER(ORDER BY celllinename ASC) as _index",
  "index_tissue": "row_number() OVER(ORDER BY tissuename ASC) as _index",
  "views": {
    "cellline": {
      "idType": "Cellline",
      "columns": {
        "celllinename": { "label": "id", "type": "string" },
        "species": { "label": "species", "type": "categorical" },
        "tumortype": { "label": "tumortype", "type": "categorical" },
        "organ": { "label": "organ", "type": "categorical" },
        "gender": { "label": "gender", "type": "categorical" }
      },
      "column_query": "celllinename as id, species, tumortype, organ, gender",

      "queryCategories": "SELECT DISTINCT %(col)s as cat FROM ${targid_bioinfodb.schema_cellline}_cellline where %(col)s is not null and %(col)s <> ''",

      "query": [
        "SELECT ${targid_bioinfodb.index_cellline}, ${column_query} ",
        "FROM ${targid_bioinfodb.schema_cellline}_cellline t",
        "ORDER BY celllinename ASC"
      ]
    },
    "cellline_filtered": {
      "idType": "Cellline",
      "query": [
        "SELECT ${targid_bioinfodb.index_cellline}, ${targid_bioinfodb.views.cellline.column_query} ",
        "FROM ${targid_bioinfodb.schema_cellline}_cellline t WHERE species = :species"
      ],
      "arguments": ["species"]
    },
    "tissue": {
      "idType": "Tissue",
      "columns": {
        "tissuename": { "label": "id", "type": "string" },
        "species": { "label": "species", "type": "categorical" },
        "tumortype": { "label": "tumortype", "type": "categorical" },
        "organ": { "label": "organ", "type": "categorical" },
        "gender": { "label": "gender", "type": "categorical" }
      },
      "column_query": "tissuename as id, species, tumortype, organ, gender",

      "queryCategories": "SELECT distinct %(col)s as cat FROM ${targid_bioinfodb.schema_tissue}_tissue WHERE %(col)s is not null AND %(col)s <> ''",

      "query": "SELECT ${targid_bioinfodb.index_tissue}, ${column_query} FROM ${targid_bioinfodb.schema_tissue}_tissue t"
    },
    "tissue_filtered": {
      "idType": "Tissue",
      "query": [
        "SELECT ${targid_bioinfodb.index_tissue}, ${targid_bioinfodb.views.tissue.column_query} ",
        "FROM ${targid_bioinfodb.schema_tissue}_tissue t ",
        "WHERE species = :species"
      ],
      "arguments": ["species"]
    },
    "gene": {
      "idType": "Ensembl",
      "columns": {
        "ensg": { "label": "id", "type": "string" },
        "symbol": { "label": "symbol", "type": "string" },
        "species":{ "label": "species", "type": "categorical" },
        "chromosome":{ "label": "chromosome", "type": "string" },
        "strand": { "label": "strand", "type": "number" },
        "biotype": { "label": "biotype", "type": "categorical" },
        "seqregionstart": { "label": "seqregionstart", "type": "number" },
        "seqregionend": { "label": "seqregionend", "type": "number" }
      },
      "column_query": "ensg as id, symbol, species, chromosome, strand, biotype, seqregionstart, seqregionend",

      "queryStats": "SELECT min(strand) as strand_min, max(strand) as strand_max, min(seqregionstart) as seqregionstart_min, max(seqregionstart) as seqregionstart_max, min(seqregionend) as seqregionend_min, max(seqregionend) as seqregionend_max FROM ${targid_bioinfodb.schema_public}_gene",
      "queryCategories": "SELECT DISTINCT %(col)s as cat FROM ${targid_bioinfodb.schema_public}_gene where %(col)s is not null and %(col)s <> ''",

      "query": "SELECT ${targid_bioinfodb.index_gene}, ${column_query} FROM ${targid_bioinfodb.schema_public}_gene t ORDER BY t.symbol ASC"
    },
    "gene_filtered": {
      "idType": "Ensembl",
      "query": "SELECT ${targid_bioinfodb.index_gene}, ${targid_bioinfodb.views.gene.column_query} FROM ${targid_bioinfodb.schema_public}_gene t WHERE species = :species ORDER BY symbol ASC",
      "arguments": ["species"]
    },
    "gene_map_ensgs": {
      "idType": "Ensembl",
      "query": "SELECT ensg as id, symbol FROM ${targid_bioinfodb.schema_public}_gene WHERE ensg in (%(ensgs)s) ORDER BY symbol ASC",
      "replacements": ["ensgs"]
    },
    "enrichment": {
      "idType": "Ensembl",
      "query": [
        "SELECT cn.ensg as id, symbol, 2*pow(2, max(cnv)) as score ",
        "FROM %(schema)s.targid_copynumber copynumberclass JOIN ${targid_bioinfodb.schema_public}_gene g on g.ensg = cn.ensg ",
        "WHERE cnv > (SELECT max(cnv) FROM %(schema)s.targid_copynumber ab INNER JOIN %(schema)s.targid_%(table_name)s b ON b.%(entity_name)s = ab.%(entity_name)s WHERE ab.cn = :cn AND b.tumortype = :tumortype AND ab.ensg = :ensg) ",
        "GROUP BY cn.ensg, symbol"
      ],
      "arguments": ["ensg", "cn", "tumortype"],
      "replacements": ["schema", "table_name", "entity_name"]
    },
    "enrichment_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT cn.ensg as id, symbol, 2*pow(2, max(cnv)) as score ",
        "FROM %(schema)s.targid_copynumber copynumberclass JOIN ${targid_bioinfodb.schema_public}_gene g on g.ensg = cn.ensg ",
        "WHERE cnv > (SELECT max(cnv) FROM %(schema)s.targid_copynumber ab INNER JOIN %(schema)s.targid_%(table_name)s b ON b.%(entity_name)s = ab.%(entity_name)s WHERE ab.cn = :cn AND ab.ensg = :ensg) ",
        "GROUP BY cn.ensg, symbol"
      ],
      "arguments": ["ensg", "cn"],
      "replacements": ["schema", "table_name", "entity_name"]
    },
    "onco_print_sample_list": {
      "idType": "Tissue",
      "query": [
        "SELECT d.%(entity_name)s as id ",
        "FROM %(schema)s.targid_%(table_name)s d",
        "WHERE d.tumortype = :tumortype"
      ],
      "arguments": ["tumortype"],
      "replacements": ["schema", "table_name", "entity_name"]
    },
    "onco_print_sample_list_all": {
      "idType": "Tissue",
      "query": [
        "SELECT d.%(entity_name)s as id ",
        "FROM %(schema)s.targid_%(table_name)s d"
      ],
      "replacements": ["schema", "table_name", "entity_name"]
    },
    "onco_print": {
      "idType": "Tissue",
      "query": [
        "SELECT d.ensg as id, d.%(entity_name)s as name, copynumberclass as cn, d.log2tpm as expr, d.dna_mutated, g.symbol ",
        "FROM %(schema)s.targid_data d INNER JOIN %(schema)s.targid_%(table_name)s c ON d.%(entity_name)s = c.%(entity_name)s INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON d.ensg = g.ensg ",
        "WHERE c.tumortype = :tumortype AND d.ensg in (%(ensgs)s)"
      ],
      "replacements": ["schema", "table_name", "entity_name", "ensgs"],
      "arguments": ["tumortype"]
    },
    "onco_print_all": {
      "idType": "Tissue",
      "query": [
        "SELECT d.ensg as id, d.%(entity_name)s as name, copynumberclass as cn, d.log2tpm as expr, d.dna_mutated, g.symbol ",
        "FROM %(schema)s.targid_data d INNER JOIN %(schema)s.targid_%(table_name)s c ON d.%(entity_name)s = c.%(entity_name)s INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON d.ensg = g.ensg ",
        "WHERE d.ensg in (%(ensgs)s)"
      ],
      "replacements": ["schema", "table_name", "entity_name", "ensgs"]
    },
    "raw_data_table": {
      "idType": "Tissue",
      "query": [
        "SELECT b.%(entity_name)s as id, g.symbol, b.species, b.organ, gender, ab.ensg, %(data_subtype)s as score ",
        "FROM %(schema)s.targid_%(table_name)s ab INNER JOIN %(schema)s.targid_%(schema)s b ON b.%(entity_name)s = ab.%(entity_name)s INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON ab.ensg = g.ensg ",
        "WHERE b.tumortype = :tumortype AND ab.ensg in (%(ensgs)s)"
      ],
      "replacements": ["schema", "table_name", "entity_name", "data_subtype", "ensgs"],
      "arguments": ["tumortype"]
    },
    "raw_data_table_all": {
      "idType": "Tissue",
      "query": [
        "SELECT b.%(entity_name)s as id, g.symbol, b.species, b.organ, gender, ab.ensg, %(data_subtype)s as score ",
        "FROM %(schema)s.targid_%(table_name)s ab INNER JOIN %(schema)s.targid_%(schema)s b ON b.%(entity_name)s = ab.%(entity_name)s INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON ab.ensg = g.ensg ",
        "WHERE ab.ensg in (%(ensgs)s)"
      ],
      "replacements": ["schema", "table_name", "entity_name", "data_subtype", "ensgs"]
    },
    "raw_data_table_inverted": {
      "idType": "Ensembl",
      "query": [
        "SELECT b.ensg as id, b.symbol, b.species, b.strand, biotype, %(entity_name)s as name, %(data_subtype)s as score ",
        "FROM %(schema)s.targid_%(table_name)s ab INNER JOIN ${targid_bioinfodb.schema_public}_gene b ON b.ensg = ab.ensg ",
        "WHERE b.biotype = :biotype AND ab.%(entity_name)s in (%(names)s)"
      ],
      "replacements": ["schema", "table_name", "entity_name", "data_subtype", "names"],
      "arguments": ["biotype"]
    },
    "raw_data_table_inverted_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT b.ensg as id, b.symbol, b.species, b.strand, biotype, %(entity_name)s as name, %(data_subtype)s as score ",
        "FROM %(schema)s.targid_%(table_name)s ab INNER JOIN ${targid_bioinfodb.schema_public}_gene b ON b.ensg = ab.ensg ",
        "WHERE ab.%(entity_name)s in (%(names)s)"
      ],
      "replacements": ["schema", "table_name", "entity_name", "data_subtype", "names"]
    },
    "co_expression": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, g.symbol, c.%(entity_name)s, a.%(expression_subtype)s as expression",
        "FROM %(schema)s.targid_expression as a ",
        "INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON a.ensg = g.ensg ",
        "INNER JOIN %(schema)s.targid_%(schema)s c ON a.%(entity_name)s = c.%(entity_name)s",
       "WHERE c.tumortype = :tumortype AND a.ensg = :ensg"
      ],
      "arguments": ["ensg", "tumortype"],
      "replacements": ["schema", "entity_name", "expression_subtype"]
    },
    "co_expression_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, g.symbol, c.%(entity_name)s, a.%(expression_subtype)s as expression",
        "FROM %(schema)s.targid_expression as a ",
        "INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON a.ensg = g.ensg ",
        "INNER JOIN %(schema)s.targid_%(schema)s c ON a.%(entity_name)s = c.%(entity_name)s",
        "WHERE a.ensg = :ensg"
      ],
      "arguments": ["ensg"],
      "replacements": ["schema", "entity_name", "expression_subtype"]
    },
    "expression_vs_copynumber": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, g.symbol, c.%(entity_name)s, a.%(expression_subtype)s as expression, b.%(copynumber_subtype)s as cn",
        "FROM %(schema)s.targid_expression as a ",
        "INNER JOIN %(schema)s.targid_copynumber as b ON a.ensg = b.ensg AND a.%(entity_name)s = b.%(entity_name)s",
        "INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON a.ensg = g.ensg ",
        "INNER JOIN %(schema)s.targid_%(schema)s c ON a.%(entity_name)s = c.%(entity_name)s",
        "WHERE c.tumortype = :tumortype AND a.ensg = :ensg"
      ],
      "arguments": ["ensg", "tumortype"],
      "replacements": ["schema", "entity_name", "expression_subtype", "copynumber_subtype"]
    },
    "expression_vs_copynumber_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, g.symbol, c.%(entity_name)s, a.%(expression_subtype)s as expression, b.%(copynumber_subtype)s as cn",
        "FROM %(schema)s.targid_expression as a ",
        "INNER JOIN %(schema)s.targid_copynumber as b ON a.ensg = b.ensg AND a.%(entity_name)s = b.%(entity_name)s",
        "INNER JOIN ${targid_bioinfodb.schema_public}_gene g ON a.ensg = g.ensg ",
        "INNER JOIN %(schema)s.targid_%(schema)s c ON a.%(entity_name)s = c.%(entity_name)s",
        "WHERE a.ensg = :ensg"
      ],
      "arguments": ["ensg"],
      "replacements": ["schema", "entity_name", "expression_subtype", "copynumber_subtype"]
    },
    "aggregated_score": {
      "idType": "Ensembl",
      "query": [
        "SELECT ensg as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM %(schema)s.targid_%(table_name)s ab INNER JOIN %(schema)s.targid_%(schema)s b ON b.%(entity_name)s = ab.%(entity_name)s ",
        "WHERE b.tumortype = :tumortype ",
        "GROUP BY ab.ensg"
      ],
      "replacements": ["schema", "entity_name", "table_name", "data_subtype", "agg"],
      "arguments": ["tumortype"]
    },
    "aggregated_score_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT ensg as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM %(schema)s.targid_%(table_name)s ab ",
        "GROUP BY ab.ensg"
      ],
      "replacements": ["schema", "entity_name", "table_name", "data_subtype", "agg"]
    },
    "aggregated_score_inverted": {
      "idType": "Tissue",
      "query": [
        "SELECT %(entity_name)s as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM %(schema)s.targid_%(table_name)s ab INNER JOIN ${targid_bioinfodb.schema_public}_gene b ON b.ensg = ab.ensg ",
        "WHERE b.biotype = :biotype ",
        "GROUP BY ab.%(entity_name)s"
      ],
      "replacements": ["schema", "entity_name", "table_name", "data_subtype", "agg"],
      "arguments": ["biotype"]
    },
    "aggregated_score_inverted_all": {
      "idType": "Tissue",
      "query": [
        "SELECT %(entity_name)s as id, %(agg)s(%(data_subtype)s) as score ",
        "FROM %(schema)s.targid_%(table_name)s ab ",
        "GROUP BY ab.%(entity_name)s"
      ],
      "replacements": ["schema", "entity_name", "table_name", "data_subtype", "agg"]
    },
    "frequency_score": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (coalesce(freq.count,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM %(schema)s.targid_%(table_name)s m INNER JOIN %(schema)s.targid_%(schema)s c ON c.%(entity_name)s = m.%(entity_name)s WHERE c.tumortype = :tumortype group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as count, ensg FROM %(schema)s.targid_%(table_name)s m INNER JOIN %(schema)s.targid_%(schema)s c ON c.%(entity_name)s = m.%(entity_name)s WHERE c.tumortype = :tumortype AND %(data_subtype)s %(operator)s %(value)s group by ensg) freq ",
        "ON freq.ensg = a.ensg"
      ],
      "replacements": ["schema", "entity_name", "table_name", "data_subtype", "operator", "value"],
      "arguments": ["tumortype"]
    },
    "frequency_score_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (coalesce(freq.count,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM %(schema)s.targid_%(table_name)s group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as count, ensg FROM %(schema)s.targid_%(table_name)s WHERE %(data_subtype)s %(operator)s %(value)s group by ensg) freq ON freq.ensg = a.ensg"
      ],
      "replacements": ["schema", "entity_name", "table_name", "data_subtype", "operator", "value"]
    },
    "mutation_frequency": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (coalesce(mut.mutated,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM %(schema)s.targid_mutation m INNER JOIN %(schema)s.targid_%(schema)s c ON c.%(entity_name)s = m.%(entity_name)s WHERE c.tumortype = :tumortype group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as mutated, ensg FROM %(schema)s.targid_mutation m INNER JOIN %(schema)s.targid_%(schema)s c ON c.%(entity_name)s = m.%(entity_name)s WHERE c.tumortype = :tumortype AND dna_mutated = 't' group by ensg) mut ",
        "ON mut.ensg = a.ensg"
      ],
      "arguments": ["tumortype"],
      "replacements": ["schema", "entity_name"]
    },
    "mutation_frequency_all": {
      "idType": "Ensembl",
      "query": [
        "SELECT a.ensg as id, (coalesce(mut.mutated,0)+0.0) / a.total as score ",
        "FROM (SELECT count(*) as total, ensg FROM %(schema)s.targid_mutation group by ensg) a ",
        "LEFT JOIN (SELECT count(*) as mutated, ensg FROM %(schema)s.targid_mutation where dna_mutated = 't' group by ensg) mut ON mut.ensg = a.ensg"
      ],
      "replacements": ["schema", "entity_name"]
    }
  }
}
